<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>レンタカー管理システム</title>
  <style>
    /* 各車両表示用のスタイル */
    .car-item {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .toggle-button, .delete-button {
      padding: 5px 10px;
      border: none;
      color: white;
      cursor: pointer;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <h1>レンタカー一覧</h1>
  
  <!-- 新しい車両を追加するフォーム -->
  <h2>新しい車両を追加</h2>
  <form id="add-car-form">
    <label>車両名: <input type="text" id="car-name" required></label><br>
    <label>ランク: <input type="number" id="car-rank" min="1" max="4" required></label><br>
    <label>状態: 
      <select id="car-status">
        <option value="available">available</option>
        <option value="unavailable">unavailable</option>
      </select>
    </label><br>
    <label>備考: <input type="text" id="car-remarks"></label><br>
    <button type="submit">追加</button>
  </form>
  
  <div id="car-list"></div>

  <!-- Firebase SDK をモジュール形式で読み込み -->
  <script type="module">
    // Firebaseの必要なモジュールをインポート
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
    import { getFirestore, collection, getDocs, updateDoc, doc, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";

    // ※ Firebaseコンソールから取得した設定情報に置き換えてください
    const firebaseConfig = {
      apiKey: "AIzaSyAfm605JtkOOyqv-dLxtoE5neHUSvjxzbg",
      authDomain: "jbrt-ddd38.firebaseapp.com",
      projectId: "jbrt-ddd38",
      // その他必要な設定情報があれば追加
    };

    // Firebaseの初期化
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ランクに応じた色の設定（例：1→赤、2→青、3→緑、4→黄色）
    const rankColors = {
      1: "red",
      2: "blue",
      3: "green",
      4: "yellow"
    };

    // Firestoreから車両データを取得して画面に表示する関数
    async function loadCars() {
      const carListDiv = document.getElementById("car-list");
      carListDiv.innerHTML = ""; // 表示内容をクリア
      const querySnapshot = await getDocs(collection(db, "cars"));
      querySnapshot.forEach((documentSnapshot) => {
        const car = documentSnapshot.data();
        // 車両情報表示用のdiv作成
        const carDiv = document.createElement("div");
        carDiv.className = "car-item";
        carDiv.id = documentSnapshot.id;  // ドキュメントIDを設定

        // 車両名、ランク、状態、備考の表示
        carDiv.innerHTML = `<strong>${car.name}</strong> <br>
                            ランク: ${car.rank} (表示色: ${rankColors[car.rank] || "gray"}) <br>
                            状態: ${car.status} <br>
                            備考: ${car.remarks}`;

        // 状態変更ボタンの作成（「available」と「unavailable」をトグル）
        const toggleButton = document.createElement("button");
        toggleButton.textContent = "状態変更";
        toggleButton.className = "toggle-button";
        toggleButton.style.backgroundColor = rankColors[car.rank] || "gray";
        toggleButton.addEventListener("click", async () => {
          const newStatus = car.status === "available" ? "unavailable" : "available";
          const carDocRef = doc(db, "cars", documentSnapshot.id);
          await updateDoc(carDocRef, { status: newStatus });
          loadCars();
        });
        
        // 削除ボタンの作成
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "削除";
        deleteButton.className = "delete-button";
        deleteButton.style.backgroundColor = "darkgray";
        deleteButton.addEventListener("click", async () => {
          const carDocRef = doc(db, "cars", documentSnapshot.id);
          await deleteDoc(carDocRef);
          loadCars();
        });

        // ボタンを追加してから、車両表示エリアに追加
        carDiv.appendChild(document.createElement("br"));
        carDiv.appendChild(toggleButton);
        carDiv.appendChild(deleteButton);
        carListDiv.appendChild(carDiv);
      });
    }

    // 新規車両追加フォームの送信処理
    document.getElementById("add-car-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      // 入力値を取得
      const name = document.getElementById("car-name").value;
      const rank = parseInt(document.getElementById("car-rank").value);
      const status = document.getElementById("car-status").value;
      const remarks = document.getElementById("car-remarks").value;

      // Firestoreに新しい車両データを追加
      await addDoc(collection(db, "cars"), { name, rank, status, remarks });
      
      // フォームのリセットと画面更新
      e.target.reset();
      loadCars();
    });

    // 初回の車両データロード
    loadCars();
  </script>
</body>
</html>
